Instructions for signing and installing TPM keys
================================================


This step used the aikblob and the aikhexmod.txt generated in step 5.

Generate a public/private key pair (the "activity policy key").

Create the directory that tcService will find the hardware keys 
and certificates as specified in "DirectoryStructure.txt", 
by default this is ROOT/HWRoot.  In an earlier step, you copied
the aikblob and the aik-hex-file into this directory.

In the executable directory type:
    cd ROOT
    ./cryptUtility.exe -GenKey RSA1024 policyPrivateKey.xml
Store the policyPrivateKey.xml in ROOT for testing.  You should 
NEVER have the private key on an insecure computer and you should
NEVER lose this key.  This key will be copied onto the 
keyNegoServer Computer later.  Put it in policy/policyPrivateKey.xml

Produce the AIK certificate by typing:
    cd ROOT
    ./cryptUtility.exe -SignHexModulus policyPrivateKey.xml HWRoot/aikhexmod.txt HWRoot/cert

Next produce a self signed cert for the policy key.  Copy
policyPublicProto.xml from this directory into ROOT/HWRoot.
Edit the file replacing the CAPITALIZED items.  Then insert
the xml in privatePolicyKey.xml into the indicated place in
policyPublicProto.xml and delete the <D:>, <P:> and <Q:> 
elements.  Sign this file by typing:
 ../cryptUtility.exe -Sign privatePolicyKey.xml rsa1024-sha256-pkcspad \
policyPublicProto.xml policyCert.xml

Produce the include file that will be used to insert the policy cert in the
activity elements.
    ./cryptUtility.exe -PolicyCert policyCert.xml policyCert.inc FileProxy
Copy policyCert.inc to Code/fileProxy and Code/tcService.


